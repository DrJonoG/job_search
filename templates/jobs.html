{% extends "base.html" %}
{% block title %}Job Board â€“ job_search{% endblock %}

{% block content %}
<!-- Header -->
<div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
    <div>
        <h3 class="fw-bold mb-1"><i class="bi bi-collection me-2 text-primary"></i>Job Board</h3>
        <p class="text-muted mb-0"><span id="totalJobs">{{ stats.total }}</span> jobs saved across all sources</p>
    </div>
    <div class="d-flex gap-2">
        <a href="/api/export" class="btn btn-outline-secondary btn-sm">
            <i class="bi bi-download me-1"></i> Export CSV
        </a>
        <button class="btn btn-primary btn-sm" onclick="window.location='/'">
            <i class="bi bi-plus-lg me-1"></i> New Search
        </button>
    </div>
</div>

<!-- Saved Board Searches Row -->
<div class="saved-searches-row mb-3" id="savedBoardSearchesRow" style="display:none;">
    <div class="d-flex align-items-center gap-2 mb-2">
        <h6 class="fw-bold mb-0 text-muted small text-uppercase" style="letter-spacing:0.08em; font-size:0.7rem;">
            <i class="bi bi-bookmark-star me-1"></i>Saved Board Searches
        </h6>
    </div>
    <div class="saved-searches-scroll" id="savedBoardSearchesList"></div>
</div>

<div class="row g-4">
    <!-- Filters Sidebar -->
    <div class="col-lg-3">
        <div class="card border-0 shadow-sm filter-sidebar">
            <div class="card-body p-4">
                <h5 class="fw-bold mb-3"><i class="bi bi-funnel me-2"></i>Filters</h5>

                <!-- Text Search -->
                <div class="mb-3">
                    <label class="form-label fw-semibold small">Search</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="bi bi-search"></i></span>
                        <input type="text" class="form-control" id="filterQuery"
                            placeholder="Job title, company...">
                    </div>
                </div>

                <!-- Source -->
                <div class="mb-3">
                    <label class="form-label fw-semibold small">Source</label>
                    <select class="form-select form-select-sm" id="filterSource">
                        <option value="">All Sources</option>
                        {% for src in sources %}
                        <option value="{{ src }}">{{ src }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Remote -->
                <div class="mb-3">
                    <label class="form-label fw-semibold small">Work Type</label>
                    <select class="form-select form-select-sm" id="filterRemote">
                        {% for opt in remote_options %}
                        <option value="{{ opt }}">{{ opt }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Job Type -->
                <div class="mb-3">
                    <label class="form-label fw-semibold small">Job Type</label>
                    <select class="form-select form-select-sm" id="filterJobType">
                        <option value="">Any</option>
                        {% for jt in job_types %}
                        <option value="{{ jt }}">{{ jt }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Min Salary -->
                <div class="mb-3">
                    <label class="form-label fw-semibold small">Minimum Salary</label>
                    <input type="number" class="form-control form-control-sm" id="filterSalaryMin"
                        placeholder="e.g. 50000" min="0" step="5000">
                </div>

                <!-- Posted in last (date_posted, fallback date_scraped) -->
                <div class="mb-3">
                    <label class="form-label fw-semibold small">Posted in last</label>
                    <select class="form-select form-select-sm" id="filterPostedInLastDays">
                        <option value="">Any</option>
                        <option value="1">1 day</option>
                        <option value="3">3 days</option>
                        <option value="7">7 days</option>
                        <option value="14">14 days</option>
                        <option value="30">30 days</option>
                    </select>
                </div>

                <!-- Region -->
                <div class="mb-3">
                    <label class="form-label fw-semibold small">Region</label>
                    <select class="form-select form-select-sm" id="filterRegion">
                        <option value="">All Regions</option>
                    </select>
                </div>

                <!-- Not Interested -->
                <div class="mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="filterIncludeNotInterested">
                        <label class="form-check-label small" for="filterIncludeNotInterested">
                            Include "not interested"
                        </label>
                    </div>
                </div>

                <!-- Sort (default: Date Posted, newest first) -->
                <div class="mb-3">
                    <label class="form-label fw-semibold small">Sort By</label>
                    <select class="form-select form-select-sm" id="filterSort">
                        <option value="date_posted" selected>Date Posted (newest first)</option>
                        <option value="date_scraped">Date Added</option>
                        <option value="salary_max">Salary (High to Low)</option>
                        <option value="title">Title (A-Z)</option>
                        <option value="company">Company (A-Z)</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold small">Order</label>
                    <select class="form-select form-select-sm" id="filterOrder">
                        <option value="desc">Descending</option>
                        <option value="asc">Ascending</option>
                    </select>
                </div>

                <button class="btn btn-outline-secondary w-100 mt-2" id="clearFilters">
                    <i class="bi bi-x-circle me-1"></i> Clear Filters
                </button>
                <button class="btn btn-outline-primary w-100 mt-2" id="saveBoardSearchBtn">
                    <i class="bi bi-bookmark-plus me-1"></i> Save Search
                </button>
            </div>
        </div>
    </div>

    <!-- Job Listings -->
    <div class="col-lg-9">
        <!-- Loading -->
        <div id="jobsLoading" class="text-center py-5" style="display:none;">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="text-muted mt-2">Loading jobs...</p>
        </div>

        <!-- Empty State -->
        <div id="jobsEmpty" class="text-center py-5" style="display:none;">
            <i class="bi bi-inbox display-1 text-muted"></i>
            <h4 class="mt-3 text-muted">No jobs found</h4>
            <p class="text-muted">Try adjusting your filters or <a href="/">run a new search</a>.</p>
        </div>

        <!-- Job List -->
        <div id="jobsList"></div>

        <!-- Pagination -->
        <nav id="paginationNav" class="mt-4" style="display:none;">
            <div class="d-flex justify-content-between align-items-center">
                <small class="text-muted" id="paginationInfo"></small>
                <ul class="pagination pagination-sm mb-0" id="paginationList"></ul>
            </div>
        </nav>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        loadRegions();
        loadJobs();
        loadSavedBoardSearches();
        const saveBoardBtn = document.getElementById('saveBoardSearchBtn');
        if (saveBoardBtn) saveBoardBtn.addEventListener('click', handleSaveBoardSearch);
    });
</script>
{% endblock %}
